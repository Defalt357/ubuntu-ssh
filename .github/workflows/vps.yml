name: VPS SSH via Serveo (6 horas)

on: [push]

jobs:
  vps:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 horas máximo

    steps:
      - name: Configurar ambiente
        run: |
          mkdir -p ~/.ssh
          echo "StrictHostKeyChecking no" >> ~/.ssh/config

      - name: Gerar chaves SSH
        run: |
          ssh-keygen -t rsa -f ~/.ssh/id_rsa -q -N ""
          cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
          chmod 600 ~/.ssh/id_rsa

      - name: Mostrar credenciais
        run: |
          echo "===================== DADOS DE ACESSO ====================="
          echo "----- CHAVE PRIVADA SSH -----"
          cat ~/.ssh/id_rsa
          echo "----- FIM DA CHAVE -----"
          echo "Aguardando conexão Serveo..."

      - name: Configurar SSH
        run: |
          sudo apt-get update
          sudo apt-get install -y openssh-server
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
          sudo service ssh restart

      -- name: Configurar Ngrok
  run: |
    curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
    echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list
    sudo apt update && sudo apt install -y ngrok
    ./ngrok authtoken ${{ secrets.NGROK_TOKEN }}
    ./ngrok tcp 22 --log=stdout > ngrok.log &
    sleep 10
    grep "url=tcp://" ngrok.log
  env:
    NGROK_TOKEN: ${{ secrets.  authtoken: 300XeosAblNXxXAml8ymDYFiVKs_54smMfL1JtBECTigf7nj5
 }}

          # Manter ativo
          sleep 21600
